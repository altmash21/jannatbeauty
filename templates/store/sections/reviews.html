{% load static %}
<section class="reviews-section">
    <div class="container">
        <div class="header-section">
            <h2 class="section-title">What Our Customers Say</h2>
            <button class="view-all-btn" onclick="toggleReviewView()">View All</button>
        </div>
        
        <div class="carousel-view" id="carouselView">
            <div class="carousel-wrapper">
                <button class="nav-button prev" onclick="navigateReviews(-1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"></path>
                    </svg>
                </button>
                
                <div class="reviews-carousel" id="reviewsCarousel">
                    <!-- Review cards will be inserted here by JavaScript -->
                </div>
                
                <button class="nav-button next" onclick="navigateReviews(1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"></path>
                    </svg>
                </button>
            </div>
            
            <div class="carousel-dots" id="reviewDots"></div>
        </div>

        <div class="reviews-grid" id="reviewsGrid">
            <!-- Grid cards will be inserted here by JavaScript -->
        </div>
    </div>
</section>

<script>
    const customerReviews = [
        {
            name: "Fatima Ahmed",
            location: "Dubai",
            product: "Premium Arabic Qur'an",
            image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&h=200&fit=crop",
            productImage: "/static/images/products/quran-premium.jpg",
            review: "The quality of this Qur'an is exceptional. The paper quality and print clarity make reading a joy.",
            rating: 5
        },
        {
            name: "Ibrahim Khan",
            location: "London",
            product: "Prayer Mat Set",
            image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop",
            productImage: "/static/images/products/prayer-mat.jpg",
            review: "Beautiful prayer mat set. The quality is excellent and the design is elegant.",
            rating: 5
        },
        {
            name: "Aisha Rahman",
            location: "Toronto",
            product: "Digital Qur'an Pen",
            image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop",
            productImage: "/static/images/products/quran-pen.jpg",
            review: "This digital Qur'an pen has made it so much easier for my children to learn and recite correctly.",
            rating: 5
        },
        {
            name: "Mohammad Ali",
            location: "Sydney",
            product: "Wooden Tasbeeh",
            image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop",
            productImage: "/static/images/products/tasbeeh.jpg",
            review: "Beautifully crafted wooden tasbeeh. The quality is outstanding and it feels great in hand.",
            rating: 5
        }
    ];

    let currentReviewIndex = 0;
    let isGridViewActive = false;

    function createReviewCard(review, index) {
        const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
        
        return `
            <div class="review-card" data-index="${index}">
                <img src="${review.image}" alt="${review.name}" class="profile-image">
                <div class="stars">${stars.split('').map(s => `<span class="star ${s === '★' ? 'filled' : ''}">${s}</span>`).join('')}</div>
                <h3 class="product-name">${review.product}</h3>
                <img src="${review.productImage}" alt="${review.product}" class="product-image">
                <p class="review-text">${review.review}</p>
                <p class="reviewer-name">${review.name}</p>
                <p class="reviewer-location">${review.location}</p>
            </div>
        `;
    }

    function createGridCard(review) {
        const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
        
        return `
            <div class="review-grid-card">
                <img src="${review.image}" alt="${review.name}" class="profile-image">
                <div class="stars">${stars.split('').map(s => `<span class="star ${s === '★' ? 'filled' : ''}">${s}</span>`).join('')}</div>
                <h3 class="product-name">${review.product}</h3>
                <img src="${review.productImage}" alt="${review.product}" class="product-image">
                <p class="review-text">${review.review}</p>
                <p class="reviewer-name">${review.name}</p>
                <p class="reviewer-location">${review.location}</p>
            </div>
        `;
    }

    function toggleReviewView() {
        isGridViewActive = !isGridViewActive;
        const carouselView = document.getElementById('carouselView');
        const gridView = document.getElementById('reviewsGrid');
        const btn = document.querySelector('.reviews-section .view-all-btn');
        
        if (isGridViewActive) {
            carouselView.classList.add('hidden');
            gridView.classList.add('active');
            btn.textContent = 'Show Carousel';
            clearInterval(reviewAutoplayInterval);
        } else {
            carouselView.classList.remove('hidden');
            gridView.classList.remove('active');
            btn.textContent = 'View All';
            reviewAutoplayInterval = setInterval(() => navigateReviews(1), 4000);
        }
    }

    function initReviewsCarousel() {
        const carousel = document.getElementById('reviewsCarousel');
        const dotsContainer = document.getElementById('reviewDots');
        const gridView = document.getElementById('reviewsGrid');
        
        if (carousel && dotsContainer && gridView) {
            carousel.innerHTML = customerReviews.map((review, index) => createReviewCard(review, index)).join('');
            dotsContainer.innerHTML = customerReviews.map((_, index) => 
                `<div class="dot ${index === 0 ? 'active' : ''}" onclick="goToReview(${index})"></div>`
            ).join('');
            gridView.innerHTML = customerReviews.map(review => createGridCard(review)).join('');
            
            updateReviewsCarousel();
        }
    }

    function updateReviewsCarousel() {
        const cards = document.querySelectorAll('.review-card');
        const dots = document.querySelectorAll('.reviews-section .dot');
        
        cards.forEach((card, index) => {
            card.className = 'review-card';
            
            if (index === currentReviewIndex) {
                card.classList.add('active');
            } else if (index === (currentReviewIndex - 1 + customerReviews.length) % customerReviews.length) {
                card.classList.add('left');
            } else if (index === (currentReviewIndex + 1) % customerReviews.length) {
                card.classList.add('right');
            }
        });
        
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentReviewIndex);
        });
    }

    function navigateReviews(direction) {
        currentReviewIndex = (currentReviewIndex + direction + customerReviews.length) % customerReviews.length;
        updateReviewsCarousel();
    }

    function goToReview(index) {
        currentReviewIndex = index;
        updateReviewsCarousel();
    }

    // Initialize carousel on page load
    document.addEventListener('DOMContentLoaded', function() {
        initReviewsCarousel();
        reviewAutoplayInterval = setInterval(() => navigateReviews(1), 4000);

        // Pause autoplay on hover
        const carouselWrapper = document.querySelector('.reviews-section .carousel-wrapper');
        if (carouselWrapper) {
            carouselWrapper.addEventListener('mouseenter', () => {
                clearInterval(reviewAutoplayInterval);
            });

            carouselWrapper.addEventListener('mouseleave', () => {
                if (!isGridViewActive) {
                    reviewAutoplayInterval = setInterval(() => navigateReviews(1), 4000);
                }
            });
        }
    });
</script>