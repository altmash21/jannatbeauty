{% extends 'base_simple.html' %}

{% block title %}Track Order {{ order.order_number|default:order.id }}{% endblock %}

{% block content %}
<div class="container" style="max-width:900px; padding:2rem 1rem;">
    <div class="card" style="padding:2rem;">
        <h2 style="margin-bottom:1.5rem;">Order Tracking</h2>
        
        <div style="background:#f5f5f5; padding:1.5rem; border-radius:8px; margin-bottom:1.5rem;">
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:1rem;">
                <div>
                    <strong>Order ID:</strong><br>
                    <span>{% if order.order_number %}#{{ order.order_number }}{% else %}#{{ order.id|slice:":8"|upper }}{% endif %}</span>
                </div>
                <div>
                    <strong>Order Date:</strong><br>
                    <span>{{ order.created|date:"M d, Y" }}</span>
                </div>
                <div>
                    <strong>Status:</strong><br>
                    <span style="color:#007bff; font-weight:600;">{{ order.get_order_status_display }}</span>
                </div>
                {% if order.awb_code %}
                <div>
                    <strong>AWB Code:</strong><br>
                    <span style="font-family:monospace;">{{ order.awb_code }}</span>
                </div>
                {% endif %}
                {% if order.courier_name %}
                <div>
                    <strong>Courier:</strong><br>
                    <span>{{ order.courier_name }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        {% if tracking_data and tracking_data.tracking_data %}
        <h3 style="margin-bottom:1rem;">Shipment Timeline</h3>
        <div style="position:relative; padding-left:2rem;">
            {% for event in tracking_data.tracking_data.shipment_track %}
            <div style="position:relative; padding-bottom:1.5rem; border-left:2px solid #e0e0e0;">
                <div style="position:absolute; left:-7px; top:5px; width:12px; height:12px; border-radius:50%; background:#007bff;"></div>
                <div style="margin-left:1rem;">
                    <div style="font-weight:600; color:#333;">{{ event.activity }}</div>
                    <div style="color:#666; font-size:0.9rem;">{{ event.location }}</div>
                    <div style="color:#999; font-size:0.85rem;">{{ event.date }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% elif tracking_data and tracking_data.error %}
        <div style="background:#fff3cd; padding:1rem; border-radius:6px; border-left:4px solid #ffc107;">
            <strong>⚠️ Tracking Error:</strong> {{ tracking_data.error }}
        </div>
        {% else %}
        <div style="background:#d1ecf1; padding:1rem; border-radius:6px; border-left:4px solid #17a2b8;">
            <strong>ℹ️ No tracking information available yet.</strong> Tracking will be available once the shipment is picked up.
        </div>
        {% endif %}

        <div style="margin-top:2rem;">
            <h3 style="margin-bottom:1rem;">Delivery Address</h3>
            <div style="background:#f5f5f5; padding:1rem; border-radius:6px;">
                <strong>{{ order.full_name }}</strong><br>
                {{ order.address }}<br>
                {{ order.city }}, {{ order.state }} {{ order.zipcode }}<br>
                Email: {{ order.email }}
            </div>
        </div>

        <div style="margin-top:2rem;">
            <h3 style="margin-bottom:1rem;">Order Items</h3>
            {% for item in order.items.all %}
            <div style="display:flex; justify-content:space-between; padding:0.75rem 0; border-bottom:1px solid #e0e0e0;">
                <div>
                    <strong>{{ item.product.name }}</strong><br>
                    <span style="color:#666; font-size:0.9rem;">Quantity: {{ item.quantity }}</span>
                </div>
                <div style="font-weight:600;">₹{{ item.get_cost }}</div>
            </div>
            {% endfor %}
            <div style="display:flex; justify-content:space-between; padding:1rem 0; font-size:1.1rem; font-weight:600;">
                <span>Total:</span>
                <span>₹{{ order.total_amount }}</span>
            </div>
        </div>

        <div style="margin-top:2rem; text-align:center;">
            <a href="{% url 'store:home' %}" class="btn btn-primary">Back to Home</a>
        </div>
    </div>
</div>
{% endblock %}
